[gd_scene load_steps=31 format=3 uid="uid://cy1leb1kiu6o4"]

[ext_resource type="Script" path="res://src/player.gd" id="1_evqos"]
[ext_resource type="Script" path="res://src/player_input_handler.gd" id="2_k1kd7"]
[ext_resource type="Shader" path="res://assets/shaders/postprocess.gdshader" id="3_34caj"]
[ext_resource type="Script" path="res://src/health_pool.gd" id="3_vwos7"]
[ext_resource type="Script" path="res://src/hurtbox.gd" id="4_ghgt8"]
[ext_resource type="Script" path="res://scenes/postprocess_hide_gizmo.gd" id="4_vv5i4"]
[ext_resource type="Script" path="res://src/Audio control node.gd" id="5_atf2r"]
[ext_resource type="Script" path="res://src/interaction_ray.gd" id="5_g8323"]
[ext_resource type="AudioStream" uid="uid://cas70e2qpascn" path="res://audio/Garden - Ambient 1.wav" id="6_gmdfq"]
[ext_resource type="Script" path="res://src/room_detector.gd" id="7_beu1l"]
[ext_resource type="PackedScene" path="res://_PROTO_/player_attack.tscn" id="11_pcjyh"]
[ext_resource type="Script" path="res://_PROTO_/tool_attack.gd" id="12_cios8"]
[ext_resource type="Script" path="res://scenes/tool_use_from_inventory.gd" id="13_mqnn4"]
[ext_resource type="Script" path="res://src/damage_instance.gd" id="13_qgojy"]
[ext_resource type="Script" path="res://_PROTO_/requirement.gd" id="15_m0vcd"]
[ext_resource type="PackedScene" uid="uid://g4jm5a62hdsg" path="res://_PROTO_/inventory_ui.tscn" id="16_gls4e"]
[ext_resource type="PackedScene" uid="uid://cpu2r44awjr47" path="res://scenes/game_ui.tscn" id="17_f2jcj"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_dtbhm"]
radius = 0.2
height = 0.594053

[sub_resource type="SeparationRayShape3D" id="SeparationRayShape3D_g0tft"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_n5pa7"]
radius = 0.4
height = 1.4

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_3igwf"]
radius = 0.4
height = 0.8

[sub_resource type="CylinderShape3D" id="CylinderShape3D_gnhj7"]
height = 0.2
radius = 0.4

[sub_resource type="ShaderMaterial" id="ShaderMaterial_61ybn"]
render_priority = 0
shader = ExtResource("3_34caj")

[sub_resource type="QuadMesh" id="QuadMesh_uf0gt"]
flip_faces = true
size = Vector2(10, 10)

[sub_resource type="SphereShape3D" id="SphereShape3D_4wjgr"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_qyid2"]
height = 1.9

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_bxkqm"]
height = 1.25

[sub_resource type="Resource" id="Resource_cacvt"]
script = ExtResource("13_qgojy")
damage = 1.0
impulse = 0.0
damage_types = 16

[sub_resource type="BoxShape3D" id="BoxShape3D_hg4dn"]
size = Vector3(0.1, 0.1, 0.1)

[sub_resource type="ButtonGroup" id="ButtonGroup_rq6di"]

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("current_tool")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -8530.66, 0)
velocity = Vector3(0, -408.817, 0)
script = ExtResource("1_evqos")
speed_crouch = 1.5
acceleration = 60.0
acceleration_air = 5.0
friction = 15.0
jump_height = 0.5
crouchjump_height = 1.0
current_tool = NodePath("PickaxeSwing")

[node name="feet" type="CollisionShape3D" parent="."]
transform = Transform3D(4.37114e-08, 1, 8.74228e-08, 1, -4.37114e-08, 0, 3.82137e-15, 8.74228e-08, -1, 0, 0.200195, 0)
shape = SubResource("CapsuleShape3D_dtbhm")

[node name="separation_ray_trail" type="CollisionShape3D" parent="."]
transform = Transform3D(-1, 8.74228e-08, -3.82137e-15, 0, -4.37114e-08, -1, -8.74228e-08, -1, 4.37114e-08, 2.77709e-08, 1, -0.317662)
shape = SubResource("SeparationRayShape3D_g0tft")

[node name="separation_ray_lead" type="CollisionShape3D" parent="."]
transform = Transform3D(-1, 8.74228e-08, -3.82137e-15, 0, -4.37114e-08, -1, -8.74228e-08, -1, 4.37114e-08, -2.78004e-08, 1, 0.318)
shape = SubResource("SeparationRayShape3D_g0tft")

[node name="separation_ray_left" type="CollisionShape3D" parent="."]
transform = Transform3D(-1, 8.74228e-08, -3.82137e-15, 0, -4.37114e-08, -1, -8.74228e-08, -1, 4.37114e-08, 0.318, 1, 2.78004e-08)
shape = SubResource("SeparationRayShape3D_g0tft")

[node name="separation_ray_right" type="CollisionShape3D" parent="."]
transform = Transform3D(-1, 8.74228e-08, -3.82137e-15, 0, -4.37114e-08, -1, -8.74228e-08, -1, 4.37114e-08, -0.318, 1, -2.78004e-08)
shape = SubResource("SeparationRayShape3D_g0tft")

[node name="body_standing" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
shape = SubResource("CapsuleShape3D_n5pa7")

[node name="body_crouching" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.7, 0)
shape = SubResource("CapsuleShape3D_3igwf")
disabled = true

[node name="floor_test" type="RayCast3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.4, 0)
target_position = Vector3(0, -0.45, 0)

[node name="standing_camera_pos" type="Marker3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.6, 0)

[node name="crouching_camera_pos" type="Marker3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.1, 0)

[node name="direction_pivot" type="Node3D" parent="."]
transform = Transform3D(-1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, 0, 0, 0)

[node name="leading_ray" type="RayCast3D" parent="direction_pivot"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.2, -0.5)
target_position = Vector3(0, -0.5, 0)
collision_mask = 3

[node name="uncrouch" type="ShapeCast3D" parent="direction_pivot"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.6, 0)
shape = SubResource("CylinderShape3D_gnhj7")
target_position = Vector3(0, 0, 0)
collision_mask = 11

[node name="feet_coll" type="RemoteTransform3D" parent="direction_pivot"]
transform = Transform3D(-4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0, 1, 0, 0.2, 0)
remote_path = NodePath("../../feet")

[node name="trail_ray_coll" type="RemoteTransform3D" parent="direction_pivot"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 1, 0.317662)
remote_path = NodePath("../../separation_ray_trail")

[node name="lead_ray_coll" type="RemoteTransform3D" parent="direction_pivot"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 1, -0.318)
remote_path = NodePath("../../separation_ray_lead")

[node name="left_ray_coll" type="RemoteTransform3D" parent="direction_pivot"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, -0.318, 1, 0)
remote_path = NodePath("../../separation_ray_left")

[node name="right_ray_coll" type="RemoteTransform3D" parent="direction_pivot"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0.318, 1, 0)
remote_path = NodePath("../../separation_ray_right")

[node name="camera_pivot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.6, 0)

[node name="Camera3D" type="Camera3D" parent="camera_pivot"]
fov = 90.0

[node name="RayCast3D" type="RayCast3D" parent="camera_pivot/Camera3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.150992, 0)
target_position = Vector3(0, 0, -1)
collision_mask = 4
collide_with_areas = true
collide_with_bodies = false
script = ExtResource("5_g8323")

[node name="postprocess" type="MeshInstance3D" parent="camera_pivot/Camera3D"]
material_override = SubResource("ShaderMaterial_61ybn")
cast_shadow = 0
extra_cull_margin = 16384.0
mesh = SubResource("QuadMesh_uf0gt")
script = ExtResource("4_vv5i4")
hideInEditor = false

[node name="OmniLight3D" type="OmniLight3D" parent="camera_pivot/Camera3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.255411, 0.234597, 0.0274304)
light_color = Color(1, 0.980392, 0.878431, 1)
light_specular = 1.0

[node name="Audio control node" type="Node3D" parent="camera_pivot/Camera3D"]
script = ExtResource("5_atf2r")

[node name="music" type="AudioStreamPlayer" parent="camera_pivot/Camera3D/Audio control node"]
stream = ExtResource("6_gmdfq")

[node name="room_detector" type="Area3D" parent="camera_pivot/Camera3D"]
collision_layer = 64
collision_mask = 0
script = ExtResource("7_beu1l")

[node name="CollisionShape3D" type="CollisionShape3D" parent="camera_pivot/Camera3D/room_detector"]
shape = SubResource("SphereShape3D_4wjgr")

[node name="attack_origin" type="Marker3D" parent="camera_pivot/Camera3D"]

[node name="PlayerInputHandler" type="Node" parent="."]
script = ExtResource("2_k1kd7")

[node name="HealthPool" type="Node" parent="." node_paths=PackedStringArray("hurtboxes")]
script = ExtResource("3_vwos7")
max_hp = 100.0
hurtboxes = [NodePath("../Hurtbox")]

[node name="Hurtbox" type="Area3D" parent="."]
collision_layer = 16
collision_mask = 0
script = ExtResource("4_ghgt8")

[node name="hurtbox_standing" type="CollisionShape3D" parent="Hurtbox"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.95, 0)
shape = SubResource("CapsuleShape3D_qyid2")

[node name="hurtbox_crouching" type="CollisionShape3D" parent="Hurtbox"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.625, 0)
shape = SubResource("CapsuleShape3D_bxkqm")
disabled = true

[node name="PickaxeSwing" parent="." node_paths=PackedStringArray("attack_origin") instance=ExtResource("11_pcjyh")]
script = ExtResource("12_cios8")
tool_id = 3
damage_instances = Array[ExtResource("13_qgojy")]([SubResource("Resource_cacvt")])
hitbox_shape = SubResource("BoxShape3D_hg4dn")
attack_origin = NodePath("../camera_pivot/Camera3D/attack_origin")

[node name="requirement" type="Node" parent="PickaxeSwing"]
script = ExtResource("15_m0vcd")

[node name="ToolAction" type="Node" parent="PickaxeSwing"]
script = ExtResource("13_mqnn4")
onHit = true

[node name="InventoryUI" parent="." instance=ExtResource("16_gls4e")]
catagory_buttons = SubResource("ButtonGroup_rq6di")

[node name="game_ui" parent="." instance=ExtResource("17_f2jcj")]

[connection signal="newRoomEntered" from="camera_pivot/Camera3D/room_detector" to="camera_pivot/Camera3D/Audio control node" method="_on_new_room_entered"]
[connection signal="inventoryState" from="InventoryUI" to="PlayerInputHandler" method="_on_inventory_ui_inventory_state_change"]
